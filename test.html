<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Soyuz Microphones Customizer — Rodyn SLAM Web v1.0</title>
  <style>
    body { margin:0; background:#000; overflow:hidden; font-family: system-ui, sans-serif; }
    #slam-canvas { display:block; width:100vw; height:100vh; }
    .ui-panel {
      position: absolute; top: 20px; left: 20px; background: rgba(20,20,30,0.85);
      padding: 20px; border-radius: 16px; color: white; width: 320px; backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.6);
    }
    h2 { margin: 0 0 20px 0; font-size: 1.4em; }
    label { display: block; margin: 16px 0 8px; font-weight: 600; }
    select, input[type="color"] {
      width: 100%; padding: 12px; border-radius: 10px; border: none;
      background: #333; color: white; font-size: 1em;
    }
    input[type="color"] { height: 60px; cursor: pointer; }
    .ral-info { font-size: 0.85em; opacity: 0.7; margin-top: 4px; }
    .hint { font-size: 0.8em; opacity: 0.6; margin-top: 20px; }
  </style>
</head>
<body>
  <canvas id="slam-canvas"></canvas>

  <div class="ui-panel">
    <h2>Soyuz Microphones Customizer</h2>
    
    <label>Модель</label>
    <select id="model-select">
      <option value="017">017 Series (Tube / FET)</option>
      <option value="023" selected>023 Bomblet</option>
    </select>

    <label>Капсула (голова + полусферы)</label>
    <input type="color" id="capsule-color" value="#b0b0b0">
    <div class="ral-info">Серебристый алюминий (примерно RAL 9006)</div>

    <label>Корпус (средняя часть)</label>
    <input type="color" id="body-color" value="#1e1e1e">
    <div class="ral-info">Чёрный матовый (примерно RAL 9005)</div>

    <label>Отделка корпуса</label>
    <select id="finish-select">
      <option value="chrome">Хром / Полированный алюминий</option>
      <option value="brass">Латунь (золотистая)</option>
      <option value="matte">Матовый</option>
      <option value="custom">Кастом (по цвету выше)</option>
    </select>

    <div class="hint">
      Управление: ЛКМ — вращение • Колёсико — зум
    </div>
  </div>

  <script>
    class SoyuzCustomizer {
      constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.resize();
        window.addEventListener('resize', () => this.resize());

        this.state = {
          model: '023', // '017' или '023'
          capsuleColor: '#b0b0b0',
          bodyColor: '#1e1e1e',
          finish: 'chrome',
          rotY: 0,
          rotX: 0.2,
          zoom: 1.0
        };

        this.mouse = { x: 0, y: 0, down: false };
        this.setupControls();
        this.animate();
      }

      resize() {
        this.canvas.width = window.innerWidth * devicePixelRatio;
        this.canvas.height = window.innerHeight * devicePixelRatio;
        this.ctx.scale(devicePixelRatio, devicePixelRatio);
      }

      setupControls() {
        document.getElementById('model-select').onchange = e => this.state.model = e.target.value;
        document.getElementById('capsule-color').oninput = e => this.state.capsuleColor = e.target.value;
        document.getElementById('body-color').oninput = e => this.state.bodyColor = e.target.value;
        document.getElementById('finish-select').onchange = e => this.state.finish = e.target.value;

        this.canvas.addEventListener('mousedown', e => {
          this.mouse.down = true;
          this.mouse.x = e.clientX;
          this.mouse.y = e.clientY;
        });
        this.canvas.addEventListener('mouseup', () => this.mouse.down = false);
        this.canvas.addEventListener('mousemove', e => {
          if (this.mouse.down) {
            this.state.rotY += (e.clientX - this.mouse.x) * 0.01;
            this.state.rotX += (e.clientY - this.mouse.y) * 0.01;
            this.mouse.x = e.clientX;
            this.mouse.y = e.clientY;
          }
        });
        this.canvas.addEventListener('wheel', e => {
          e.preventDefault();
          this.state.zoom = Math.max(0.5, Math.min(3, this.state.zoom - e.deltaY * 0.001));
        });
      }

      project3D(x, y, z) {
        const { rotX, rotY } = this.state;
        // Вращение по Y
        let cx = x * Math.cos(rotY) - z * Math.sin(rotY);
        let cz = x * Math.sin(rotY) + z * Math.cos(rotY);
        // Вращение по X
        let cy = y * Math.cos(rotX) - cz * Math.sin(rotX);
        cz = y * Math.sin(rotX) + cz * Math.cos(rotX);
        // Перспектива
        const scale = 800 / (800 + cz);
        return {
          x: cx * scale,
          y: cy * scale,
          scale: scale
        };
      }

      drawMicrophone() {
        const { ctx, state } = this;
        const w = window.innerWidth;
        const h = window.innerHeight;

        ctx.clearRect(0, 0, w, h);

        ctx.save();
        ctx.translate(w / 2, h / 2);
        ctx.scale(state.zoom, state.zoom);

        // Тень на "полу"
        ctx.fillStyle = 'rgba(0,0,0,0.4)';
        ctx.beginPath();
        ctx.ellipse(0, 220, 100, 40, 0, 0, Math.PI * 2);
        ctx.fill();

        const is023 = state.model === '023';

        // Параметры модели
        const bodyHeight = is023 ? 160 : 180;
        const bodyWidth = is023 ? 70 : 65;
        const capsuleRadius = is023 ? 95 : 85;

        // Определяем цвет корпуса
        let bodyMainColor = state.bodyColor;
        if (state.finish === 'brass') bodyMainColor = '#d4af37';
        else if (state.finish === 'chrome') bodyMainColor = '#e8e8e8';

        // Корпус (цилиндр с градиентом)
        const bodyGrad = ctx.createLinearGradient(-bodyWidth, -bodyHeight/2, bodyWidth, bodyHeight/2);
        bodyGrad.addColorStop(0, this.lighten(bodyMainColor, 30));
        bodyGrad.addColorStop(0.5, bodyMainColor);
        bodyGrad.addColorStop(1, this.darken(bodyMainColor, 20));
        ctx.fillStyle = bodyGrad;
        ctx.fillRect(-bodyWidth, -bodyHeight/2, bodyWidth*2, bodyHeight);

        // Блик на корпусе
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        ctx.fillRect(-bodyWidth/3, -bodyHeight/2, bodyWidth/6, bodyHeight);

        // Капсула: нижняя полусфера + верхняя + голова
        ctx.fillStyle = state.capsuleColor;

        // Нижняя полусфера
        ctx.beginPath();
        ctx.ellipse(0, bodyHeight/2 + capsuleRadius/2, capsuleRadius, capsuleRadius, 0, 0, Math.PI * 2);
        ctx.fill();

        // Верхняя полусфера
        ctx.beginPath();
        ctx.ellipse(0, -bodyHeight/2 - capsuleRadius/2, capsuleRadius, capsuleRadius, 0, 0, Math.PI * 2);
        ctx.fill();

        // Голова (сетка)
        ctx.fillStyle = '#d4af37'; // классический золотой гриль
        ctx.beginPath();
        ctx.ellipse(0, -bodyHeight/2 - capsuleRadius/2 - 10, capsuleRadius - 5, (capsuleRadius - 5) * 0.75, 0, 0, Math.PI * 2);
        ctx.fill();

        // Сетка на голове (упрощённая)
        ctx.strokeStyle = '#b8860b';
        ctx.lineWidth = 2;
        for (let i = -capsuleRadius + 20; i < capsuleRadius - 10; i += 15) {
          ctx.beginPath();
          ctx.moveTo(i, -bodyHeight/2 - capsuleRadius/2 - 40);
          ctx.lineTo(i, -bodyHeight/2 - capsuleRadius/2 + 20);
          ctx.stroke();
        }
        for (let i = -40; i < 40; i += 15) {
          ctx.beginPath();
          ctx.moveTo(-capsuleRadius + 20, -bodyHeight/2 - capsuleRadius/2 + i);
          ctx.lineTo(capsuleRadius - 10, -bodyHeight/2 - capsuleRadius/2 + i);
          ctx.stroke();
        }

        // Лого SOYUZ (красный ромб)
        ctx.fillStyle = '#c41e3a';
        ctx.save();
        ctx.rotate(-Math.PI / 12);
        ctx.beginPath();
        ctx.moveTo(0, -15);
        ctx.lineTo(35, 0);
        ctx.lineTo(0, 15);
        ctx.lineTo(-35, 0);
        ctx.closePath();
        ctx.fill();

        ctx.fillStyle = 'white';
        ctx.font = 'bold 18px serif';
        ctx.textAlign = 'center';
        ctx.fillText('SOYUZ', 0, 5);
        ctx.restore();

        ctx.restore();
      }

      lighten(color, percent) {
        const num = parseInt(color.replace("#",""),16),
              amt = Math.round(2.55 * percent),
              R = (num >> 16) + amt,
              G = (num >> 8 & 0x00FF) + amt,
              B = (num & 0x0000FF) + amt;
        return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 + (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255)).toString(16).slice(1);
      }

      darken(color, percent) {
        return this.lighten(color, -percent);
      }

      animate() {
        this.drawMicrophone();
        requestAnimationFrame(() => this.animate());
      }
    }

    // Запуск
    window.onload = () => {
      new SoyuzCustomizer(document.getElementById('slam-canvas'));
      console.log('Soyuz Customizer → FULLY COHERENT | 60 FPS | Canvas2D');
    };
  </script>
</body>
</html>